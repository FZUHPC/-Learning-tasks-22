# HPL



[TOC]

## 测试环境

* 架高笔记本，增强散热。
* 网络连接、电源连接。
* 后台基本无其它应用。

## 参考

[HPL测试_GUANYX~的博客-CSDN博客](https://blog.csdn.net/gyx1549624673/article/details/86551466)

[linpack实验：MPI性能参数调优_linpack测试参数_HowsenFisher的博客-CSDN博客](https://blog.csdn.net/yu_223/article/details/115983923?ops_request_misc=%7B%22request%5Fid%22%3A%22167948304916800197058922%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=167948304916800197058922&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-115983923-null-null.142^v76^pc_search_v2,201^v4^add_ask,239^v2^insert_chatgpt&utm_term=HPL调优&spm=1018.2226.3001.4187)

以及一些其他的。

## 理论

* 本机cpu：12th Gen Intel(R) Core(TM) i5-12500H   2.50 GHz

  * 官网上看`Instruction Set Extensions :Intel® SSE4.1, Intel® SSE4.2, Intel® AVX2`

  * 每时钟周期浮点运算次数=16

* 虚拟机主频3.1GHz  

  ```
  yang@yang-virtual-machine:~/hpl-2.3/bin/test$ cat /proc/cpuinfo | grep "processor" | wc -l
  8
  yang@yang-virtual-machine:~/hpl-2.3/bin/test$ cat /proc/cpuinfo | grep "cpu cores" | uniq
  cpu cores	: 4
  ```

* 理论峰值：`Gfloat=8*3.1*16=396.8`

## 初始

* 初始HPL.dat

```bash
#第一、二行：说明文字
HPLinpack benchmark input file
Innovative Computing Laboratory, University of Tennessee
#第三行：
HPL.out      output file name (if any)
#第四行："device out"为"6"时，测试结果输出至标准输出（stdout）,"device out"为"7"时，测试结果输出至标准错误输出（stderr）,"device out"为其它值时，测试结果输出至第三行所指定的文件中.
6            device out (6=stdout,7=stderr,file)
#第五行：矩阵的数量，如1即一个矩阵
4            # of problems sizes (N)
#第六行：问题规模大小N值,要考虑内存容量的制约关系，有一个达到最佳性能的上限值。384倍数
29 30 34 35  Ns 
#第七行：测试块的个数
4            # of NBs 
#第八行：系数矩阵被分成NBxNB的循环块被分配到各个进程当中去处理，NB不可能太大或太小，一般在256以下，NBx8一定是Cache line的倍数等。一般选择128。
1 2 3 4      NBs
#第九行：选择处理器阵列是按列的排列方式还是按行的排列方式。（按列的排列方式适用于节点数较多、每个节点内CPU数较少的系统；而按行的排列方式适用于节点数较少、每个节点内CPU数较多的大规模系统）
0            PMAP process mapping (0=Row-,1=Column-major)
#第10~12行：说明二维处理器网格（P × Q），要求：P × Q = 系统CPU数 = 进程数。P最好选择2的幂，P的值尽量取得小一点
3            # of process grids (P x Q)
2 1 4        Ps
2 4 1        Qs
#第13行：说明测试的精度。若误差在这个值以内就是正确，否则错误。
16.0         threshold
#第14~21行：指明L分解的方式，L、R、C，分别代表Left、Right和Crout。测试经验，NDIVs选择2比较理想，NBMINs 4或8都不错。（后续2、4好像优于4、8但是最好的结果是4、8）
3            # of panel fact
0 1 2        PFACTs (0=left, 1=Crout, 2=Right)
2            # of recursive stopping criterium
2 4          NBMINs (>= 1)
1            # of panels in recursion
2            NDIVs
3            # of recursive panel fact.
0 1 2        RFACTs (0=left, 1=Crout, 2=Right)
#第22~23行：L的横向广播方式，HPL中提供了6种广播方式。一般来说，在小规模系统中，选择0或1；对于大规模系统，选择3。（选择3比较好）
1            # of broadcast
0            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)
#第24~25行：说明横向通信的通信深度。
1            # of lookahead depth
0            DEPTHs (>=0)
#第26~27行：U的广播算法，SWAP="0"，采用二元交换法；SWAP="1"，采用Long法；SWAP="2"，采用混合法。
2            SWAP (0=bin-exch,1=long,2=mix)
64           swapping threshold
#第28~29行：说明L和U的数据存放格式。"transposed"，按列存放，否则按行存放。
0            L1 in (0=transposed,1=no-transposed) form
0            U  in (0=transposed,1=no-transposed) form
#第30行：主要在回代中使用，一般使用其默认值
1            Equilibration (0=no,1=yes)
#第31行：值主要为内存地址对齐而设置，用于在内存分配中对齐地址。出于安全考虑，可以选择８。
8            memory alignment in double (> 0)
```

* 初始结果：

```
WR00R2R4          35     4     1     4               0.00             2.7444e-01
```

* 初始比值：2.7444e-01/396.8=0.06916%

## 参数考虑（主要）

**问题规模大小N**

问题规模大小N值,要考虑内存容量的制约关系，有一个达到最佳性能的上限值。我们可以用物理内存的容量（单位：byte）乘以80%~85%来进行HPL的运算，剩余内存用于保证系统中的其他程序正常运行。由于一个双精度数占8个字节，所以再处以8，将结果开平方，得到的值比较接近最佳N值。根据经验似乎为384倍数更佳。

每组的规模的最大取值根据公式 `N*N*8=内存容量*80%`计算得出。

```
yang@yang-virtual-machine:~/hpl-2.3/bin/test$ free -h
               total        used        free      shared  buff/cache   available
Mem:           7.7Gi       1.7Gi       4.3Gi        69Mi       1.7Gi       5.7Gi
Swap:          3.8Gi          0B       3.8Gi
yang@yang-virtual-machine:~/hpl-2.3/bin/test$ free -b
               total        used        free      shared  buff/cache   available
Mem:      8299274240  1879293952  4646662144    72769536  1773318144  6080458752
Swap:     4087345152           0  4087345152
```

由`N*N*8=4646662144*80%`得N=21556，考虑384的倍数，应该为21504。

但是之后发现剩余内存量发生了改变。

**P*Q**

P × Q = 系统CPU数 = 进程数 = 8

一般P<Q,且P为的幂

后续`1*8，2*4，4*2，8*1`

**矩阵分块NB**

系数矩阵被分成NBxNB的循环块被分配到各个进程当中去处理，NB不可能太大或太小，一般在256以下，NBx8一定是Cache line的倍数等。

取32，64，128，192，256等

## 测试

### 改变P*Q

修改推荐配置前：

| 序号 | Ns    | NBs  | P    | Q    | time  | **Gflops** | 比值   |
| ---- | ----- | ---- | ---- | ---- | ----- | ---------- | ------ |
| 1    | 5760  | 128  | 1    | 8    | 1.15  | 1.1072e+02 | 27.90% |
| 2    | 5760  | 128  | 2    | 4    | 1.11  | 1.1471e+02 | 28.90% |
| 3    | 5760  | 128  | 4    | 2    | 1.13  | 1.1247e+02 | 28.34% |
| 4    | 5760  | 128  | 8    | 1    | 1.32  | 9.6597e+01 | 24.34% |
| 5    | 5760  | 128  | 1    | 4    | 1.78  | 7.1473e+01 |        |
| 6    | 5760  | 128  | 2    | 2    | 1.77  | 7.1817e+01 |        |
| 7    | 5760  | 128  | 4    | 1    | 1.84  | 6.9139e+01 |        |
| 8    | 9600  | 128  | 1    | 8    | 4.60  | 1.2826e+02 | 32.32% |
| 9    | 9600  | 128  | 2    | 4    | 4.61  | 1.2791e+02 | 32.24% |
| 10   | 9600  | 128  | 4    | 2    | 4.62  | 1.2765e+02 | 32.17% |
| 11   | 13440 | 128  | 1    | 8    | 11.99 | 1.3503e+02 | 34.03% |
| 12   | 13440 | 128  | 2    | 4    | 11.71 | 1.3819e+02 | 34.83% |
| 13   | 13440 | 128  | 4    | 2    | 12.49 | 1.2962e+02 | 32.67% |
| 14   | 19200 | 128  | 1    | 8    | 33.46 | 1.4103e+02 | 35.54% |
| 15   | 19200 | 128  | 2    | 4    | 32.49 | 1.4527e+02 | 36.61% |

> * P*Q=4时，命令从mpirun -np 8 ./xhpl改为mpirun -np 4 ./xhpl（-np 8Gflops值反而更小）
> * P*Q为`8*1`及`4*2`的数据，以及`P*Q=4`的数据是为了验证参考博客的内容。

修改推荐配置后：

```bash
HPLinpack benchmark input file
Innovative Computing Laboratory, University of Tennessee
HPL.out      output file name (if any)
6            device out (6=stdout,7=stderr,file)
1            # of problems sizes (N)
19200  Ns
1            # of NBs
128          NBs
1            PMAP process mapping (0=Row-,1=Column-major)
1            # of process grids (P x Q)
2            Ps
4            Qs
16.0         threshold
1            # of panel fact
1            PFACTs (0=left, 1=Crout, 2=Right)
2            # of recursive stopping criterium
4 8          NBMINs (>= 1)
1            # of panels in recursion
2            NDIVs
1            # of recursive panel fact.
2            RFACTs (0=left, 1=Crout, 2=Right)
2            # of broadcast
3            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)
2            # of lookahead depth
0 1          DEPTHs (>=0)
2            SWAP (0=bin-exch,1=long,2=mix)
64           swapping threshold
0            L1 in (0=transposed,1=no-transposed) form
0            U  in (0=transposed,1=no-transposed) form
1            Equilibration (0=no,1=yes)
8            memory alignment in double (> 0)
```

| 序号 | Ns    | NBs  | P    | Q    | time  | **Gflops** | 比值   |
| ---- | ----- | ---- | ---- | ---- | ----- | ---------- | ------ |
| 1    | 5760  | 128  | 1    | 8    | 1.04  | 1.2261e+02 | 30.90% |
| 2    | 5760  | 128  | 2    | 4    | 1.01  | 1.2628e+02 | 31.82% |
| 3    | 9600  | 128  | 1    | 8    | 4.35  | 1.3554e+02 | 34.16% |
| 4    | 9600  | 128  | 2    | 4    | 4.24  | 1.3912e+02 | 35.06% |
| 5    | 13440 | 128  | 1    | 8    | 11.45 | 1.4132e+02 | 35.61% |
| 6    | 13440 | 128  | 2    | 4    | 11.57 | 1.3997e+02 | 35.27% |
| 7    | 19200 | 128  | 1    | 8    | 33.75 | 1.3983e+02 | 35.24% |
| 8    | 19200 | 128  | 2    | 4    | 37.04 | 1.4268e+02 | 35.96% |

发现：

* 修改推荐配置后Ns为5760、9600、13440的Gflops有所提高，但Ns为19200的Gflops却降低了。
* 大部分情况下，P*Q为`2*4`是优于`1*8`的。后续将只测试前者。
* 后续可能需要用修改推荐配置前（即默认配置）的进行测试。
* 目前最优的是`WR00L2L2       19200   128     2     4              32.49             1.4527e+02`(默认配置下)，比值36.61%

### 改变NBs

| 序号 | Ns    | NBs  | P    | Q    | time  | Gflops     |
| ---- | ----- | ---- | ---- | ---- | ----- | ---------- |
| 1    | 19200 | 32   | 2    | 4    | 40.46 | 1.1664e+02 |
| 2    | 19200 | 64   | 2    | 4    | 35.66 | 1.3235e+02 |
| 3    | 19200 | 96   | 2    | 4    | 33.44 | 1.4114e+02 |
| 4    | 19200 | 128  | 2    | 4    | 32.81 | 1.4382e+02 |
| 5    | 19200 | 160  | 2    | 4    | 33.74 | 1.3985e+02 |
| 6    | 19200 | 192  | 2    | 4    | 34.31 | 1.3756e+02 |
| 7    | 19200 | 224  | 2    | 4    | 34.83 | 1.3548e+02 |
| 8    | 19200 | 256  | 2    | 4    | 34.46 | 1.3694e+02 |

**Ns=19200，P=2，Q=4：**

| 序号 | NBs  | time  | Gflops     |
| ---- | ---- | ----- | ---------- |
| 1    | 80   | 32.86 | 1.4361e+02 |
| 2    | 96   | 32.95 | 1.4321e+02 |
| 3    | 112  | 32.20 | 1.4654e+02 |
| 4    | 128  | 33.36 | 1.4148e+02 |
| 5    | 144  | 31.89 | 1.4796e+02 |
| 6    | 160  | 32.96 | 1.4318e+02 |
| 7    | 176  | 32.40 | 1.4566e+02 |
| 8    | 192  | 33.21 | 1.4210e+02 |
| 9    | 208  | 32.72 | 1.4424e+02 |
| 10   | 224  | 33.12 | 1.4247e+02 |
| 11   | 240  | 33.64 | 1.4247e+02 |
| 12   | 256  | 34.95 | 1.3501e+02 |

整合（**Ns=19200，P=2，Q=4**）：

| 序号 | NBs  | time  | Gflops         | 比值   |
| ---- | ---- | ----- | -------------- | ------ |
| 1    | 32   | 40.46 | 1.1664e+02     | 29.40% |
| 2    | 64   | 35.66 | 1.3235e+02     | 33.35% |
| 3    | 80   | 32.86 | 1.4361e+02     | 36.19% |
| 4    | 96   | 32.95 | 1.4321e+02     | 36.09% |
| 5    | 112  | 32.20 | **1.4654e+02** | 36.93% |
| 6    | 128  | 32.81 | 1.4382e+02     | 36.24% |
| 7    | 144  | 31.89 | **1.4796e+02** | 37.29% |
| 8    | 160  | 32.96 | 1.4318e+02     | 36.08% |
| 9    | 176  | 32.40 | **1.4566e+02** | 36.71% |
| 10   | 192  | 33.21 | 1.4210e+02     | 35.81% |
| 11   | 208  | 32.72 | 1.4424e+02     | 36.35% |
| 12   | 224  | 33.12 | 1.4247e+02     | 35.90% |
| 13   | 240  | 33.64 | 1.4028e+02     | 35.35% |
| 14   | 256  | 34.46 | 1.3694e+02     | 34.51% |

* 目前最优的是`WC10R2C8       19200   144     2     4              31.89             1.4796e+02`，比值37.29%。
* 问题：不同时间测试的数据差距明显。
* 可能需要改变Ns的值，再进行测试，测试NBs值为80、96、112、128、144、160、176、192、208、（224）

**P=2，Q=4：**

| Ns    | NBs     | time  | Gflops         |
| ----- | ------- | ----- | -------------- |
| 13440 | 80      | 11.90 | 1.3601e+02     |
| 13440 | 96      | 11.80 | 1.3714e+02     |
| 13440 | 112     | 11.86 | 1.3651e+02     |
| 13440 | 128     | 11.84 | 1.3674e+02     |
| 13440 | **144** | 11.65 | **1.3893e+02** |
| 13440 | 160     | 11.90 | 1.3600e+02     |
| 13440 | **176** | 11.63 | **1.3924e+02** |
| 13440 | 192     | 12.20 | 1.3263e+02     |
| 13440 | **208** | 11.48 | **1.4100e+02** |
| 13440 | 224     | 12.07 | 1.3408e+02     |
| 9600  | **96**  | 4.40  | **1.3399e+02** |
| 9600  | 112     | 4.48  | 1.3169e+02     |
| 9600  | 128     | 4.57  | 1.2898e+02     |
| 9600  | 144     | 4.48  | 1.3161e+02     |
| 9600  | **160** | 4.29  | **1.3764e+02** |
| 9600  | **176** | 4.48  | **1.3179e+02** |
| 9600  | 192     | 4.55  | 1.2968e+02     |
| 9600  | 208     | 4.63  | 1.2755e+02     |
| 5760  | 96      | 1.06  | 1.1991e+02     |
| 5760  | 112     | 1.07  | 1.1924e+02     |
| 5760  | 128     | 1.06  | 1.2039e+02     |
| 5760  | **144** | 1.04  | **1.2223e+02** |
| 5760  | **160** | 1.06  | **1.2057e+02** |
| 5760  | **176** | 1.04  | **1.2224e+02** |
| 5760  | 192     | 1.12  | 1.1428e+02     |
| 5760  | 208     | 1.08  | 1.1827e+02     |

* 13440最好的是NBs值是144、176、208
* 9600：96、160、176
* 5760：144、160、208
* 19200：112、144、176

### 改变Ns

**P=2，Q=4**

| Gflops   | NBs=96     | NBs=112    | NBs=128    | NBs=144    | NBs=160        | NBs=176    | Ns=208     |
| -------- | ---------- | ---------- | ---------- | ---------- | -------------- | ---------- | ---------- |
| Ns=9600  | 1.3572e+02 | 1.3466e+02 | 1.3144e+02 | 1.3140e+02 | 1.3377e+02     | 1.3346e+02 | 1.2844e+02 |
| Ns=10240 | 1.3226e+02 | 1.3196e+02 | 1.3078e+02 | 1.3213e+02 | 1.3047e+02     | 1.3226e+02 | 1.3148e+02 |
| Ns=11520 | 1.3498e+02 | 1.3381e+02 | 1.3237e+02 | 1.3526e+02 | 1.3519e+02     | 1.3559e+02 | 1.3299e+02 |
| Ns=13440 | 1.3499e+02 | 1.4110e+02 | 1.4013e+02 | 1.4283e+02 | 1.3909e+02     | 1.4047e+02 | 1.3519e+02 |
| Ns=15360 | 1.4118e+02 | 1.4189e+02 | 1.3854e+02 | 1.4053e+02 | 1.4462e+02     | 1.4399e+02 | 1.3862e+02 |
| Ns=17280 | 1.4049e+02 | 1.4109e+02 | 1.3978e+02 | 1.4205e+02 | 1.4345e+02     | 1.4181e+02 | 1.3738e+02 |
| Ns=19200 | 1.4415e+02 | 1.4227e+02 | 1.4060e+02 | 1.4284e+02 | **1.4663e+02** | 1.4419e+02 | 1.4243e+02 |
| Ns=21120 | 1.4085e+02 | 1.4245e+02 | 1.4250e+02 | 1.4346e+02 | 1.4434e+02     | 1.4469e+02 | 1.4235e+02 |
| Ns=23040 |            |            |            | 1.1883e+02 | 1.1841e+02     | 1.1942e+02 |            |

```
yang@yang-virtual-machine:~/hpl-2.3/bin/test$ free -b
               total        used        free      shared  buff/cache   available
内存： 8299270144  1793114112  5403443200    51945472  1102712832  6197198848
交换： 4087345152           0  4087345152
```

由`N*N*8=5403443200*80%`考虑384的倍数，应该为23040。

> 测试完21120之后，再次进行测试时，发现电脑cpu使用率只有在刚运行时能达到于之前测试时差不多的数值，然后就不断下降，维持在一个不高的值。然后发现了电脑中的野兽模式，N=23040，NB为96、112、128、208的就没有继续测试。

### 打开电脑的野兽模式

并将任务管理器中`VMware Workstation VMX`调到实时

<img src="C:\Users\yqq\Pictures\Screenshots\屏幕截图 2023-04-03 123958.png" style="zoom: 33%;" />

测试1：

| 序号  | Ns    | NBs  | P    | Q    | time  | Gflops     | 比值       |
| ----- | ----- | ---- | ---- | ---- | ----- | ---------- | ---------- |
| 1     | 19200 | 144  | 2    | 4    | 26.49 | 1.7818e+02 | 44.90%     |
| 2     | 19200 | 160  | 2    | 4    | 24.48 | 1.9278e+02 | 48.58%     |
| **3** | 19200 | 176  | 2    | 4    | 24.17 | 1.9523e+02 | **49.20%** |
| 4     | 21120 | 144  | 2    | 4    | 33.03 | 1.9018e+02 | 47.93%     |
| 5     | 21120 | 160  | 2    | 4    | 37.92 | 1.6566e+02 | 41.75%     |
| 6     | 21120 | 176  | 2    | 4    | 32.83 | 1.9133e+02 | 48.22%     |

* 比值终于达到了4开头，将近5，虽然离理想（6~7）还是差很多。

测试2：

| 序号 | Ns    | NBs  | P    | Q    | time  | Gflops     | 比值   |
| ---- | ----- | ---- | ---- | ---- | ----- | ---------- | ------ |
| 1    | 21504 | 112  | 2    | 4    | 40.79 | 1.6253e+02 | 40.96% |
| 2    | 21504 | 144  | 2    | 4    | 37.55 | 1.7655e+02 | 44.49% |
| 3    | 21504 | 160  | 2    | 4    | 39.67 | 1.6715e+02 | 42.12% |
| 4    | 21504 | 176  | 2    | 4    | 38.25 | 1.7331e+02 | 43.68% |

测试3（两次）：

| 序号  | Ns    | NBs  | P    | Q    | time  | Gflops     | 比值       |
| ----- | ----- | ---- | ---- | ---- | ----- | ---------- | ---------- |
| 1     | 23040 | 112  | 2    | 4    | 41.80 | 1.9509e+02 | 49.17%     |
| 2     | 23040 | 144  | 2    | 4    | 40.61 | 2.0082e+02 | 50.61%     |
| **3** | 23040 | 160  | 2    | 4    | 39.21 | 2.0799e+02 | **52.42%** |
| 4     | 23040 | 176  | 2    | 4    | 40.21 | 2.0281e+02 | 51.11%     |
| 5     | 23040 | 96   | 2    | 4    | 46.71 | 1.7457e+02 | 43.99%     |
| 6     | 23040 | 128  | 2    | 4    | 44.02 | 1.8523e+02 | 46.68%     |
| 7     | 23040 | 144  | 2    | 4    | 39.65 | 2.0564e+02 | 51.82%     |

* 比值达到5开头。

测试4：

| 序号 | Ns    | NBs  | P    | Q    | time  | Gflops     | 比值\% |
| ---- | ----- | ---- | ---- | ---- | ----- | ---------- | ------ |
| 1    | 23424 | 144  | 2    | 4    | 41.52 | 2.0639e+02 | 52.01  |
| 2    | 23424 | 160  | 2    | 4    | 46.13 | 1.8576e+02 | 46.81  |
| 3    | 23424 | 168  | 2    | 4    | 44.23 | 1.9372e+02 | 48.82  |
| 4    | 23424 | 176  | 2    | 4    | 42.39 | 2.0217e+02 | 50.95  |
| 5    | 23424 | 208  | 2    | 4    | 48.30 | 1.7741e+02 | 44.71  |
| 6    | 23424 | 256  | 2    | 4    | 49.54 | 1.7297e+02 | 43.59  |
| 7    | 23424 | 96   | 2    | 4    | 45.80 | 1.8711e+02 | 47.15  |
| 8    | 23424 | 128  | 2    | 4    | 43.47 | 1.9713e+02 | 49.68  |

测试5：

（由于刚开机，先跑了别的数据，再测试）

| 序号 | Ns    | NBs  | P    | Q    | time  | Gflops         | 比值\|% |
| ---- | ----- | ---- | ---- | ---- | ----- | -------------- | ------- |
| 1    | 23040 | 144  | 2    | 4    | 45.61 | 1.7880e+02     | 45.06   |
| 2    | 23040 | 160  | 2    | 4    | 40.58 | 2.0097e+02     | 50.65   |
| 3    | 23040 | 176  | 2    | 4    | 42.09 | 1.9375e+02     | 48.83   |
| 4    | 23424 | 144  | 2    | 4    | 44.45 | 1.9277e+02     | 48.58   |
| 5    | 23424 | 160  | 2    | 4    | 44.97 | 1.9054e+02     | 48.02   |
| 6    | 23424 | 176  | 2    | 4    | 39.60 | **2.1636e+02** | 54.53   |
| 7    | 23808 | 144  | 2    | 4    | 50.48 | 1.7825e+02     | 44.92   |
| 8    | 23808 | 160  | 2    | 4    | 44.32 | 2.0303e+02     | 51.17   |
| 9    | 23808 | 176  | 2    | 4    | 46.73 | 1.9252e+02     | 48.52   |

* 其中6号数据最优，也是目前最好的结果，达到54.53%。

### 修改其他配置

**全部改为初始配置**

PMAP process mapping为0.

```
3            # of panel fact
0 1 2        PFACTs (0=left, 1=Crout, 2=Right)
2            # of recursive stopping criterium
2 4          NBMINs (>= 1)
1            # of panels in recursion
2            NDIVs
3            # of recursive panel fact.
0 1 2        RFACTs (0=left, 1=Crout, 2=Right)
1            # of broadcast
0            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)
1            # of lookahead depth
0            DEPTHs (>=0)
2            SWAP (0=bin-exch,1=long,2=mix)
64           swapping threshold
0            L1 in (0=transposed,1=no-transposed) form
0            U  in (0=transposed,1=no-transposed) form
1            Equilibration (0=no,1=yes)
8            memory alignment in double (> 0)
```

| 序号 | Ns    | NBs  | P    | Q    | time  | Gflops     |
| ---- | ----- | ---- | ---- | ---- | ----- | ---------- |
| 1    | 23040 | 144  | 2    | 4    | 42.80 | 1.9051e+02 |
| 2    | 23040 | 160  | 2    | 4    | 45.55 | 1.7902e+02 |
| 3    | 23040 | 176  | 2    | 4    | 42.38 | 1.9240e+02 |
| 4    | 23424 | 144  | 2    | 4    | 45.74 | 1.8735e+02 |
| 5    | 23424 | 160  | 2    | 4    | 46.27 | 1.8518e+02 |
| 6    | 23424 | 176  | 2    | 4    | 43.25 | 1.9811e+02 |
| 7    | 23808 | 144  | 2    | 4    | 48.04 | 1.8728e+02 |
| 8    | 23808 | 160  | 2    | 4    | 47.81 | 1.8820e+02 |
| 9    | 23808 | 176  | 2    | 4    | 46.56 | 1.9325e+02 |

* 全部修改并没有出现跟P*Q测试中，默认配置>推荐配置的情况。
* 总体来说，比测试5差。

**修改1（NBMINs、PMAP process mapping）**

```
HPLinpack benchmark input file
Innovative Computing Laboratory, University of Tennessee
HPL.out      output file name (if any)
6            device out (6=stdout,7=stderr,file)
1            # of problems sizes (N)
23424        Ns
3            # of NBs
144 160 176  NBs
1            PMAP process mapping (0=Row-,1=Column-major)
1            # of process grids (P x Q)
2            Ps
4            Qs
16.0         threshold
3            # of panel fact
0 1 2        PFACTs (0=left, 1=Crout, 2=Right)
2            # of recursive stopping criterium
4 8          NBMINs (>= 1)
1            # of panels in recursion
2            NDIVs
3            # of recursive panel fact.
0 1 2        RFACTs (0=left, 1=Crout, 2=Right)
1            # of broadcast
0            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)
1            # of lookahead depth
0            DEPTHs (>=0)
2            SWAP (0=bin-exch,1=long,2=mix)
64           swapping threshold
0            L1 in (0=transposed,1=no-transposed) form
0            U  in (0=transposed,1=no-transposed) form
1            Equilibration (0=no,1=yes)
8            memory alignment in double (> 0)
```

| 序号 | Ns    | NBs  | PMAP process mapping | NBMINs | P    | Q    | time  | Gflops     |
| ---- | ----- | ---- | :------------------: | ------ | ---- | ---- | ----- | ---------- |
| 1    | 23424 | 144  |          1           | 4、8   | 2    | 4    | 46.31 | 1.8505e+02 |
| 2    | 23424 | 160  |          1           | 4、8   | 2    | 4    | 46.40 | 1.8467e+02 |
| 3    | 23424 | 176  |          1           | 4、8   | 2    | 4    | 44.76 | 1.9144e+02 |
| 4    | 23424 | 144  |          0           | 4、8   | 2    | 4    | 48.51 | 1.7664e+02 |
| 5    | 23424 | 160  |          0           | 4、8   | 2    | 4    | 46.92 | 1.8262e+02 |
| 6    | 23424 | 176  |          0           | 4、8   | 2    | 4    | 45.22 | 1.8949e+02 |
| 7    | 23424 | 144  |          0           | 2、4   | 2    | 4    | 46.88 | 1.8280e+02 |
| 8    | 23424 | 160  |          0           | 2、4   | 2    | 4    | 45.48 | 1.8842e+02 |
| 9    | 23424 | 176  |          0           | 2、4   | 2    | 4    | 43.97 | 1.9487e+02 |
| 10   | 23424 | 144  |          1           | 2、4   | 2    | 4    | 44.29 | 1.9349e+02 |
| 11   | 23424 | 160  |          1           | 2、4   | 2    | 4    | 43.28 | 1.9800e+02 |
| 12   | 23424 | 176  |          1           | 2、4   | 2    | 4    | 42.22 | 2.0298e+02 |

* NBMINs为2、4，PMAP process mapping为1时较优。

**修改2（BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)）**

```
HPLinpack benchmark input file
Innovative Computing Laboratory, University of Tennessee
HPL.out      output file name (if any)
6            device out (6=stdout,7=stderr,file)
1            # of problems sizes (N)
23424        Ns
3            # of NBs
144 160 176  NBs
1            PMAP process mapping (0=Row-,1=Column-major)
1            # of process grids (P x Q)
2            Ps
4            Qs
16.0         threshold
3            # of panel fact
0 1 2        PFACTs (0=left, 1=Crout, 2=Right)
2            # of recursive stopping criterium
2 4          NBMINs (>= 1)
1            # of panels in recursion
2            NDIVs
3            # of recursive panel fact.
0 1 2        RFACTs (0=left, 1=Crout, 2=Right)
1            # of broadcast
3            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)
1            # of lookahead depth
0            DEPTHs (>=0)
2            SWAP (0=bin-exch,1=long,2=mix)
64           swapping threshold
0            L1 in (0=transposed,1=no-transposed) form
0            U  in (0=transposed,1=no-transposed) form
1            Equilibration (0=no,1=yes)
8            memory alignment in double (> 0)
```

| 序号 | Ns    | NBs  | BCASTs | P    | Q    | time  | Gflops     |
| ---- | ----- | ---- | :----: | ---- | ---- | ----- | ---------- |
| 1    | 23424 | 144  |   3    | 2    | 4    | 44.51 | 1.9254e+02 |
| 2    | 23424 | 160  |   3    | 2    | 4    | 46.13 | 1.8577e+02 |
| 3    | 23424 | 176  |   3    | 2    | 4    | 44.52 | 1.9249e+02 |
| 4    | 23424 | 144  |   0    | 2    | 4    | 48.12 | 1.7806e+02 |
| 5    | 23424 | 160  |   0    | 2    | 4    | 47.57 | 1.8013e+02 |
| 6    | 23424 | 176  |   0    | 2    | 4    | 45.68 | 1.8759e+02 |
| 7    | 23424 | 144  |   1    | 2    | 4    | 47.49 | 1.8043e+02 |
| 8    | 23424 | 160  |   1    | 2    | 4    | 46.50 | 1.8429e+02 |
| 9    | 23424 | 176  |   1    | 2    | 4    | 45.29 | 1.8919e+02 |
| 10   | 23424 | 144  |   2    | 2    | 4    | 46.32 | 1.8501e+02 |
| 11   | 23424 | 160  |   2    | 2    | 4    | 45.67 | 1.8761e+02 |
| 12   | 23424 | 176  |   2    | 2    | 4    | 47.17 | 1.8166e+02 |
| 13   | 23424 | 144  |   4    | 2    | 4    | 51.52 | 1.6632e+02 |
| 14   | 23424 | 160  |   4    | 2    | 4    | 48.38 | 1.7712e+02 |
| 15   | 23424 | 176  |   4    | 2    | 4    | 47.93 | 1.7878e+02 |
| 16   | 23424 | 144  |   5    | 2    | 4    | 49.48 | 1.7318e+02 |
| 17   | 23424 | 160  |   5    | 2    | 4    | 47.74 | 1.7950e+02 |
| 18   | 23424 | 176  |   5    | 2    | 4    | 45.56 | 1.8809e+02 |

* 相对来说，推荐的3比较好。



## 总结

* 最优的比值（2.1636e+02）/396.8=54.53%
* 配置如下（跟修改其他配置的不一样诶）：

```
HPLinpack benchmark input file
Innovative Computing Laboratory, University of Tennessee
HPL.out      output file name (if any)
6            device out (6=stdout,7=stderr,file)
1            # of problems sizes (N)
23424  Ns
1            # of NBs
176          NBs
1            PMAP process mapping (0=Row-,1=Column-major)
1            # of process grids (P x Q)
2            Ps
4            Qs
16.0         threshold
1            # of panel fact
1            PFACTs (0=left, 1=Crout, 2=Right)
2            # of recursive stopping criterium
4 8          NBMINs (>= 1)
1            # of panels in recursion
2            NDIVs
1            # of recursive panel fact.
2            RFACTs (0=left, 1=Crout, 2=Right)
2            # of broadcast
3            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)
2            # of lookahead depth
0 1          DEPTHs (>=0)
2            SWAP (0=bin-exch,1=long,2=mix)
64           swapping threshold
0            L1 in (0=transposed,1=no-transposed) form
0            U  in (0=transposed,1=no-transposed) form
1            Equilibration (0=no,1=yes)
8            memory alignment in double (> 0)
```






































